# üíæ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å TF-IDF –º–æ–¥–µ–ª–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

### ‚ùå –ë—ã–ª–æ (–ø—Ä–æ–±–ª–µ–º–∞)

```
–ó–∞–≥—Ä—É–∑–∫–∞ CV:
  parser = CVParser()
  –æ–±—É—á–∏—Ç—å TF-IDF –Ω–∞ 25 CV
  process –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è ‚Üí TF-IDF —Ç–µ—Ä—è–µ—Ç—Å—è ‚ùå

–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:
  parser = CVParser()  ‚Üê –ù–û–í–´–ô, –ø—É—Å—Ç–æ–π TF-IDF
  search_cvs() ‚Üí TF-IDF –Ω–µ –æ–±—É—á–µ–Ω
  fallback –Ω–∞ dense-only
  
–†–µ–∑—É–ª—å—Ç–∞—Ç: Hybrid search –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

### ‚úÖ –°—Ç–∞–ª–æ (—Ä–µ—à–µ–Ω–∏–µ)

```
–ó–∞–≥—Ä—É–∑–∫–∞ CV:
  parser = CVParser()
  –æ–±—É—á–∏—Ç—å TF-IDF –Ω–∞ 25 CV
  –°–û–•–†–ê–ù–ò–¢–¨ –º–æ–¥–µ–ª—å –≤ data/models/tfidf_CVs.pkl ‚úÖ
  process –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:
  parser = CVParser()
  –ó–ê–ì–†–£–ó–ò–¢–¨ –º–æ–¥–µ–ª—å –∏–∑ data/models/tfidf_CVs.pkl ‚úÖ
  search_cvs() ‚Üí TF-IDF –æ–±—É—á–µ–Ω!
  Hybrid search —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ
```

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—É—á–µ–Ω–∏–∏:**
```python
# –í create_embeddings()
if not self._tfidf_fitted:
    self.sparse_model.fit(corpus)
    self._tfidf_fitted = True
    self.save_tfidf_model()  # ‚Üê –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ!
```

**–ü—Ä–∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–∏:**
```python
# –í refit_tfidf()
parser.refit_tfidf()  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é auto_save=True
# ‚Üí –ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

**–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
```python
parser = CVParser(collection_name="CVs")

# –í–Ω—É—Ç—Ä–∏ __init__:
if self.tfidf_model_path.exists():
    self.load_tfidf_model()  # ‚Üê –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞!
    print("‚úÖ TF-IDF –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
```

## üìÅ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–æ–¥–µ–ª–∏

```
data/
‚îî‚îÄ‚îÄ models/
    ‚îú‚îÄ‚îÄ tfidf_CVs.pkl           # –î–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ "CVs"
    ‚îú‚îÄ‚îÄ tfidf_CVs_test.pkl      # –î–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ "CVs_test"
    ‚îî‚îÄ‚îÄ tfidf_experiment.pkl    # –î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
```

**–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏:** `tfidf_{collection_name}.pkl`

## üì¶ –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ

```python
{
    'sparse_model': TfidfVectorizer(...),  # –û–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
    'corpus': [text1, text2, ...],         # –ö–æ—Ä–ø—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    'fitted': True,                        # –§–ª–∞–≥ –æ–±—É—á–µ–Ω–Ω–æ—Å—Ç–∏
    'vocabulary_size': 8543                # –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è
}
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–æ–¥–µ–ª–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CV

```bash
# –®–∞–≥ 1: –ó–∞–≥—Ä—É–∂–∞–µ–º CV
python app/load_txt_to_qdrant.py

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
  1. parser = CVParser() ‚Üí –º–æ–¥–µ–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è
  2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º CV_1 ‚Üí TF-IDF –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ [CV_1]
  3. –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï ‚Üí data/models/tfidf_CVs.pkl —Å–æ–∑–¥–∞–Ω
  4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º CV_2 ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ—Ä–ø—É—Å [CV_1, CV_2]
  5. ...
  6. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º CV_25 ‚Üí –∫–æ—Ä–ø—É—Å [CV_1, ..., CV_25]
  7. refit_tfidf() ‚Üí –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö 25
  8. –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï ‚Üí –º–æ–¥–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞

# –®–∞–≥ 2: –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
python app/run_evaluation.py

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
  1. parser = CVParser() ‚Üí –ê–í–¢–û–ó–ê–ì–†–£–ó–ö–ê –∏–∑ tfidf_CVs.pkl ‚úÖ
  2. search_cvs() ‚Üí TF-IDF –æ–±—É—á–µ–Ω –Ω–∞ 25 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
  3. Hybrid search —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö CV

```bash
# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–µ–∑—é–º–µ
python app/load_txt_to_qdrant.py

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
  1. parser = CVParser() ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç tfidf_CVs.pkl (25 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
  2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º CV_26 ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ—Ä–ø—É—Å [1-26]
  3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º CV_27 ‚Üí –∫–æ—Ä–ø—É—Å [1-27]
  4. refit_tfidf() ‚Üí –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö 27
  5. –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï ‚Üí –º–æ–¥–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è 27 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

```bash
# –ö–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
python app/run_experiments.py

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç "baseline":
  collection_name="CVs_baseline"
  ‚Üí data/models/tfidf_CVs_baseline.pkl

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç "trigrams":
  collection_name="CVs_trigrams"
  ‚Üí data/models/tfidf_CVs_trigrams.pkl

# –ú–æ–¥–µ–ª–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç! ‚úÖ
```

## üõ†Ô∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏

### –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –≤—Ä—É—á–Ω—É—é

```python
from service.parse_pdf import CVParser

parser = CVParser(collection_name="CVs")
parser.save_tfidf_model()
```

### –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –≤—Ä—É—á–Ω—É—é

```python
parser = CVParser(collection_name="CVs")
success = parser.load_tfidf_model()

if success:
    print(f"–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ö–æ—Ä–ø—É—Å: {len(parser._tfidf_corpus)} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")
```

### –£–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å (–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è)

```bash
rm data/models/tfidf_CVs.pkl

# –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å
python app/load_txt_to_qdrant.py
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–∏

```python
parser = CVParser(collection_name="CVs")

print(f"TF-IDF –æ–±—É—á–µ–Ω: {parser._tfidf_fitted}")
print(f"–ö–æ—Ä–ø—É—Å: {len(parser._tfidf_corpus)} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")
print(f"–ü—É—Ç—å –∫ –º–æ–¥–µ–ª–∏: {parser.tfidf_model_path}")
print(f"–ú–æ–¥–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {parser.tfidf_model_path.exists()}")
```

## üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤

–ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö corpus:

| –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ | –†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ | –°–ª–æ–≤–∞—Ä—å |
|------------|---------------|---------|
| 10 CV | ~500KB | ~3-5K —Å–ª–æ–≤ |
| 25 CV | ~1-2MB | ~8-10K —Å–ª–æ–≤ |
| 100 CV | ~5-8MB | ~15-20K —Å–ª–æ–≤ |
| 1000 CV | ~30-50MB | ~50-80K —Å–ª–æ–≤ |

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö CV **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –≤—ã–∑–æ–≤–∏—Ç–µ:
```python
parser.refit_tfidf()  # –ü–µ—Ä–µ–æ–±—É—á–∏—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### 2. –†–∞–∑–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ = —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏

```python
parser1 = CVParser(collection_name="CVs")
# ‚Üí data/models/tfidf_CVs.pkl

parser2 = CVParser(collection_name="CVs_test")
# ‚Üí data/models/tfidf_CVs_test.pkl
```

### 3. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π sklearn

–ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å sklearn –≤–µ—Ä—Å–∏–∏ X –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –≤–µ—Ä—Å–∏–∏ Y.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ sklearn –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å:
```bash
rm data/models/*.pkl
python app/load_txt_to_qdrant.py
```

### 4. Git ignore

–î–æ–±–∞–≤—å—Ç–µ –≤ `.gitignore`:
```
data/models/*.pkl
```

–ú–æ–¥–µ–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ—Ä–ø—É—Å–∞, –Ω–µ –Ω—É–∂–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "TF-IDF –Ω–µ –æ–±—É—á–µ–Ω" –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–¥–µ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
ls data/models/

# –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ CV –∑–∞–Ω–æ–≤–æ
python app/load_txt_to_qdrant.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: Hybrid search –Ω–µ —É–ª—É—á—à–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏

**–ü—Ä–∏—á–∏–Ω—ã:**
1. TF-IDF –æ–±—É—á–µ–Ω –Ω–∞ –º–∞–ª–æ–º –∫–æ—Ä–ø—É—Å–µ (< 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã TF-IDF –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã
3. Dense embeddings —É–∂–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∂–∏–º—ã
python app/compare_search_modes.py

# –ï—Å–ª–∏ —É–ª—É—á—à–µ–Ω–∏–µ < 5%, Dense-only –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –≤–µ—Ä—Å–∏—è sklearn –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç–µ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ
rm data/models/tfidf_CVs.pkl
python app/load_txt_to_qdrant.py
```

## üéì Best Practices

1. ‚úÖ **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–µ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ
2. ‚úÖ **–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è CV** –≤—ã–∑—ã–≤–∞–π—Ç–µ `refit_tfidf()`
3. ‚úÖ **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –≤–∞–∂–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–µ—Å–ª–∏ –±–æ–ª—å—à–æ–π –∫–æ—Ä–ø—É—Å)
4. ‚úÖ **–û–¥–Ω–∞ –º–æ–¥–µ–ª—å –Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—é** - –Ω–µ –ø—É—Ç–∞–π—Ç–µ
5. ‚úÖ **–ò–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –≤ git** - –º–æ–¥–µ–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ persistence:

**–î–æ:**
```
Hybrid search: ‚ùå –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (TF-IDF —Ç–µ—Ä—è–µ—Ç—Å—è)
–ú–µ—Ç—Ä–∏–∫–∏: —Ç–æ–ª—å–∫–æ Dense-only
```

**–ü–æ—Å–ª–µ:**
```
Hybrid search: ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç (TF-IDF –ø–µ—Ä—Å–∏—Å—Ç–∏—Ç—Å—è)
–ú–µ—Ç—Ä–∏–∫–∏: Dense + TF-IDF
–£–ª—É—á—à–µ–Ω–∏–µ: +15-30% –≤ MAP –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–∑–∏—Ü–∏–π
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –ó–∞–≥—Ä—É–∑–∏—Ç–µ CV: `python app/load_txt_to_qdrant.py`
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å: `ls data/models/`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ü–µ–Ω–∫—É: `python app/run_evaluation.py`
- [ ] –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∂–∏–º—ã: `python app/compare_search_modes.py`

**–¢–µ–ø–µ—Ä—å Hybrid Search –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏! üéâ**
